<html>
<head>
	<title>New Project</title>
	<link rel="stylesheet" href="css/main.css">
	<script type="text/javascript" src="lib/mustache.js"></script>
	<script type="text/javascript" src="lib/knockout.js"></script>
	<script type="text/javascript" src="lib/ko.mustache.js"></script>
	<script type="text/javascript" src="lib/sha.js"></script>
	<script type="text/javascript" src="js/main.js"></script>
	<script type="text/javascript" src="js/Favor.js"></script>
	<script type="text/javascript" src="js/VideoHandler.js"></script>
	<script type="text/javascript" src="js/HashVerifier.js"></script>

	<script type="text/javascript" src="lib/jsqrcode/src/grid.js"></script>
	<script type="text/javascript" src="lib/jsqrcode/src/version.js"></script>
	<script type="text/javascript" src="lib/jsqrcode/src/detector.js"></script>
	<script type="text/javascript" src="lib/jsqrcode/src/formatinf.js"></script>
	<script type="text/javascript" src="lib/jsqrcode/src/errorlevel.js"></script>
	<script type="text/javascript" src="lib/jsqrcode/src/bitmat.js"></script>
	<script type="text/javascript" src="lib/jsqrcode/src/datablock.js"></script>
	<script type="text/javascript" src="lib/jsqrcode/src/bmparser.js"></script>
	<script type="text/javascript" src="lib/jsqrcode/src/datamask.js"></script>
	<script type="text/javascript" src="lib/jsqrcode/src/rsdecoder.js"></script>
	<script type="text/javascript" src="lib/jsqrcode/src/gf256poly.js"></script>
	<script type="text/javascript" src="lib/jsqrcode/src/gf256.js"></script>
	<script type="text/javascript" src="lib/jsqrcode/src/decoder.js"></script>
	<script type="text/javascript" src="lib/jsqrcode/src/qrcode.js"></script>
	<script type="text/javascript" src="lib/jsqrcode/src/findpat.js"></script>
	<script type="text/javascript" src="lib/jsqrcode/src/alignpat.js"></script>
	<script type="text/javascript" src="lib/jsqrcode/src/databr.js"></script>


	<script>
		ko.setTemplateEngine(new ko.mustacheTemplateEngine());
	</script>

	<script id="example-template" type="text/x-handlebars-template">
		<div>
				<span data-bind="text: message"></span>
		</div>
	</script>

</head>

<body>
<div id="testbar"><a class="testbar" href="test/test.html" target="_blank">Run the Tests!</a></div>
<span id="example" data-bind="template: { name: 'example-template', foreach: favorArray }"></span>
<video id="video" width="640" height="480" hidden="true" autoplay></video>
<canvas id="qr-canvas" width="640" height="480"></canvas>
<button id="snap" onclick="
	streamVideoToCanvas();checkForQRCode()">Scan</button>
<div id="hashRead" data-bind="text: hashRead"></div>
<div id="result" data-bind="text: result"></div>
</body>

<script>

	this.favorArray = ko.observableArray([
			new Favor("ce3551a8d999a88480ba1e417a4e17f79a0bb029167b6d753289bb0f76ce40e9bf9e4b8f3c47e6249600976879c5311c21772dd4f6fdc9dd8d31e55eca1e78b7",
				"Unspecified Favor 1", null, null, false),
			new Favor("465da7b2c3785a0b13f24be81c5b02ab784ac61e5bd88c74607ccedb45faa2f59675b9164de06c44aafaa4dab40ceb4277723867bfe3258e6b926bc22fd89a81",
				"Unspecified Favor 2", null, null, false),
			new Favor("3fb0e6d1d27ee4734892dc1dc7c58719e1f28b8f45d1cbec1c8af1b1ab18bdf849aca3e2637db188ec9ad958f8cbbe454fb652e18f77023d15c449dd89ef0ccc",
				"Unspecified Favor 3", null, null, false)
	]);
	ko.applyBindingsToNode(document.getElementById('example'), null, window);

	this.hashRead = ko.observable("");
	this.result = ko.observable("");
	ko.applyBindingsToNode(document.getElementById('hashRead'), null, window);
	ko.applyBindingsToNode(document.getElementById('result'), null, window);


	var hashVerifier = new HashVerifier(favorArray());
	function checkForQRCode() {
		setTimeout(function(){
			var interval = null;
			interval = setInterval(function() {
				try {
					var result = qrcode.decode();
					console.log(result)
					clearInterval(interval);
					window.result(result)
					var hashValid = hashVerifier.verify(result);
					if (hashValid == hashVerifier.VALID) {
						hashRead('VALID');
					} else {
						hashRead('INVALID');
					}
				} catch(e) {
					console.log(e);
				}
			}, 3000);
		}, 5000);


	}


</script>


</html>